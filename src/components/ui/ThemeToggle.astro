---
import { Icon } from 'astro-icon/components';
---

<button
  x-data="{
    theme: localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'),
    toggle() {
      this.theme = this.theme === 'light' ? 'dark' : 'light';
      localStorage.setItem('theme', this.theme);
      document.documentElement.classList.toggle('dark', this.theme === 'dark');
    },
    init() {
       // Watch for system preference changes if no manual override
       // Ensure correct class on load
       if (this.theme === 'dark') {
         document.documentElement.classList.add('dark');
       } else {
         document.documentElement.classList.remove('dark');
       }
    }
  }"
  @click="toggle()"
  class="fixed top-4 right-4 z-50 rounded-full bg-gray-200 p-2 text-gray-800 shadow-lg transition-colors duration-200 hover:bg-gray-300 dark:bg-gray-800 dark:text-gray-200 dark:hover:bg-gray-700"
  aria-label="Toggle theme"
>
  <span x-show="theme === 'light'" class="block">
    <Icon name="lucide:sun" class="size-5" />
  </span>
  <span x-show="theme === 'dark'" style="display: none;" class="block">
    <Icon name="lucide:moon" class="size-5" />
  </span>
</button>
